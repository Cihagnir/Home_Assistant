
////// 
//      INCLUDE SECTION 
//////

// Hand Made Libraries Section
#include "WiFi_Defns.h"
#include "Socket_Defns.h"
#include "Esp_Cam_SD_Defns.h"



////// 
//      PROJECT DEFINE SECTION  
//////

/*
static char image_array[16][16][8]  = {
    {"0xfffeff" ,"0xfbfeff" ,"0xf4fbff" ,"0xfff1f8" ,"0xf3fffc" ,"0xfafaf4" ,"0xfffcfb" ,"0xf4f4ff" ,"0xfff4ff" ,"0xf8f4fa" ,"0xfffff9" ,"0xf6f8ec" ,"0xfffeff" ,"0xfff8ff" ,"0xfefcff" ,"0xf8fff8" },
    {"0xeffffb" ,"0xfff0f4" ,"0xedfdff" ,"0xfffeff" ,"0xeaffee" ,"0xf1fff9" ,"0xeffbf5" ,"0xfafef9" ,"0xfffffc" ,"0xf7faff" ,"0xfbfcff" ,"0xfdfdff" ,"0xfffcfb" ,"0xfffffc" ,"0xfffffe" ,"0xf3f9f8" },
    {"0xf8ffee" ,"0xfdfffc" ,"0xb2beca" ,"0x9d7e93" ,"0xc3d9e5" ,"0x9ea4c9" ,"0x9f8eb3" ,"0x87a38c" ,"0x7f8f7e" ,"0xc8dbc8" ,"0xebfcee" ,"0xfaffff" ,"0xfdf6ff" ,"0xfffaff" ,"0xfdfbfa" ,"0xfbfff8" },
    {"0xffe8ff" ,"0xfffff2" ,"0x8c72a0" ,"0xae3eae" ,"0x8c5993" ,"0xaa57c4" ,"0x9434b0" ,"0x5d8434" ,"0x82b55b" ,"0x699259" ,"0x799187" ,"0xdce3f2" ,"0xfdffff" ,"0xfffff0" ,"0xfffff7" ,"0xfaf4ff" },
    {"0xe0fcf6" ,"0xf3fff6" ,"0xaed3db" ,"0x8e51a7" ,"0xb25bb7" ,"0xa345b0" ,"0x7e659d" ,"0x6fda37" ,"0x81c157" ,"0x7ec351" ,"0x689d4d" ,"0x97ad9a" ,"0xf8f7ff" ,"0xfffbff" ,"0xfefcfb" ,"0xfcfdff" },
    {"0xfffff1" ,"0xf2f0e8" ,"0xa9bab7" ,"0xbc5eb7" ,"0xb745bb" ,"0xc54cbe" ,"0xa160ab" ,"0x6eb749" ,"0x8ede4f" ,"0x75c63b" ,"0x6fac52" ,"0x90ab97" ,"0xf1f6f9" ,"0xfdfff1" ,"0xfffffb" ,"0xfff6ff" },
    {"0xffe9ff" ,"0xf7fff6" ,"0x8082a0" ,"0x9635bb" ,"0x76618e" ,"0x9b76a4" ,"0x7c35ae" ,"0x5a965a" ,"0x72b84d" ,"0x94e854" ,"0x7ec846" ,"0x5e8155" ,"0xd2d1e5" ,"0xfef7ff" ,"0xfcfbf7" ,"0xfdfffe" },
    {"0xf6fff0" ,"0xfff8ff" ,"0xdefcdf" ,"0x8b8b85" ,"0x4a8842" ,"0x61b72b" ,"0x5d953c" ,"0x78c03e" ,"0x66a74b" ,"0x7bcb42" ,"0x66ae32" ,"0x51734b" ,"0xcdcce0" ,"0xfffcff" ,"0xf8f9ef" ,"0xfdfffe" },
    {"0xfffcff" ,"0xfcfff0" ,"0xccd7d5" ,"0x6973a3" ,"0x4b57a5" ,"0x465a9b" ,"0x5f71a0" ,"0x4b5584" ,"0x4d5a88" ,"0x536796" ,"0x415798" ,"0x4959a6" ,"0x5c6898" ,"0xc6d3d1" ,"0xfdfff5" ,"0xfff9ff" },
    {"0xfffaff" ,"0xfffeff" ,"0xd4d8e3" ,"0x525784" ,"0x46509d" ,"0x4755a7" ,"0x35438f" ,"0x5963a9" ,"0x535fa5" ,"0x3e4c98" ,"0x4152a3" ,"0x3b4592" ,"0x585e8b" ,"0xd5d9e4" ,"0xf7f6f8" ,"0xfffaff" },
    {"0xfafff1" ,"0xfbfef5" ,"0xfafcfd" ,"0xb7bcd5" ,"0x474e93" ,"0x6e72e3" ,"0x5d5fe3" ,"0x5c5ddd" ,"0x5e5fdf" ,"0x5f5ee3" ,"0x6f70e2" ,"0x494e93" ,"0xb9bdd6" ,"0xfbfdfe" ,"0xfcfff6" ,"0xfafff1" },
    {"0xf7fbff" ,"0xfdf9ff" ,"0xfcf5ff" ,"0xf4f7ff" ,"0x687294" ,"0x525bb2" ,"0x5a64d0" ,"0x4f5fc0" ,"0x505dbf" ,"0x5d64d1" ,"0x5559b1" ,"0x687193" ,"0xf8faff" ,"0xfff6ff" ,"0xfff8ff" ,"0xf6f9fe" },
    {"0xf8ffee" ,"0xf6f9f0" ,"0xfcfaf2" ,"0xfdfff4" ,"0xacb6c0" ,"0x323b7b" ,"0x494fae" ,"0x3a439d" ,"0x4149a3" ,"0x3d41a0" ,"0x373b7c" ,"0xb8c1cb" ,"0xf8fbeb" ,"0xfbf8f0" ,"0xfffff9" ,"0xfaffee" },
    {"0xf5f8ff" ,"0xfffbff" ,"0xfffdff" ,"0xfbfcf2" ,"0xf8fff9" ,"0x9fafb6" ,"0x8493a6" ,"0x92a1b4" ,"0x8c9aad" ,"0x8f9eb1" ,"0x9dadb4" ,"0xf6fff7" ,"0xfffff8" ,"0xfffdff" ,"0xfdf7ff" ,"0xfbfdff" },
    {"0xfdfffb" ,"0xfffff5" ,"0xfffff9" ,"0xfffeff" ,"0xf4f8f9" ,"0xf8fffc" ,"0xf9fcff" ,"0xf6f0ff" ,"0xf4f0ff" ,"0xf9feff" ,"0xf8fffc" ,"0xf2f7f8" ,"0xfffeff" ,"0xfffff9" ,"0xfcfff4" ,"0xfbfffb" },
    {"0xfffbff" ,"0xfffffc" ,"0xfffcfe" ,"0xfff8ff" ,"0xfdfbff" ,"0xfafff1" ,"0xffffee" ,"0xfffcff" ,"0xfffcff" ,"0xfafce9" ,"0xf7fff0" ,"0xfafcff" ,"0xfef7ff" ,"0xfffcfe" ,"0xfffffc" ,"0xfbfcff" }
};
*/

static char *end_message = "END";
static camera_fb_t *picture_start_pointer ;

////// 
//      MAIN LOOP  
//////

void app_main(void){

    esp_err_t nsv_return = nvs_flash_init();

    if (nsv_return == ESP_ERR_NVS_NO_FREE_PAGES || nsv_return == ESP_ERR_NVS_NEW_VERSION_FOUND) {
      ESP_ERROR_CHECK(nvs_flash_erase());
      nsv_return = nvs_flash_init();
    }
    ESP_ERROR_CHECK(nsv_return);
    
    // Module Init Section
    WiFi_Init_Sta();

    Camera_Init();

    SD_Card_Init();

    Socket_Connection_Hand();

    while (1){ 
      
      picture_start_pointer = Cam_Take_Picture();

      ESP_LOGE("SOCKET :", "Picture len %d", picture_start_pointer->len);

      Socket_Message_Sender_Hand(picture_start_pointer->buf, picture_start_pointer->len,0);

      vTaskDelay(500 / portTICK_PERIOD_MS);

      esp_camera_fb_return(picture_start_pointer);

      
    }
    


    // xTaskCreate(Tcp_Client_Task, "tcp_client", 4096, NULL, 5, NULL);

}
